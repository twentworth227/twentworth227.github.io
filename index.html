<!DOCTYPE html>
<html>
<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-170291980-1"></script>
  <script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-170291980-1');
  </script>
  <meta charset='utf-8' />
  <title>Wentuini</title>
  <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
  <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.1.1/mapbox-gl.js'></script>
  <script src="https://use.fontawesome.com/ada9a9a588.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
  <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.1.1/mapbox-gl.css' rel='stylesheet' />
  <link href="stylesheet.css" rel="stylesheet" type="text/css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">

  <style>
  body { margin:0; padding:0; }
  #map { position:absolute; top:0; bottom:0; width:100%; }

</style>
</head>
<body>
  <div id='map'></div>
  <nav id="filter-group" class="filter-group"></nav>
  <div class="title-overlay">
    <h3><u>Juliette and Thomas' favorite places :)</u></h3>
    <h4>Click a point to see the name and location.</h4>
    <div>
      <div class="info-overlay">
        <div class="collapse" id='features'>
          <h5>I drove across the country asking people one question:</h5>
          <h4>Is there something you try to live by every day?</h4>
        </div>
        <!-- <div class="text-center">
        <a class="collapse-btn text-toggle" data-toggle="collapse" data-target="#features" aria-expanded="false">
        <span class="text-collapsed"><i class="far fa-chevron-up"></i> Learn more <i class="far fa-chevron-up"></i></span>
        <span class="text-expanded"><i class="far fa-chevron-down"></i> Learn less <i class="far fa-chevron-down"></i></span>
      </a>
    </div> -->
  </div>

  <script>
  mapboxgl.accessToken = 'pk.eyJ1IjoidHdlbnR3b3J0aCIsImEiOiJjank3bmthZXEwMWN5M2hvMmVpZDV4aWhyIn0.aEBI-qd5b-yv7wbstwhLnA';

  const points = {
    "type": "FeatureCollection",
    "features": [
      { "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [-105.281910, 40.017800]
      },
      "properties": {
        "unique_id": "1001",
        "title": "Next Door American Eatery",
        "address": "1035 Pearl St, Boulder, CO 80302",
        "icon": "restaurant-15"
      }
      },
      { "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [-105.264880, 40.020690]
      },
      "properties": {
        "unique_id": "1002",
        "title": "River and Woods",
        "address": "2328 Pearl St, Boulder, CO 80302",
        "icon": "restaurant-15"
      }
      },
      { "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [-70.255410, 43.666030]
      },
      "properties": {
        "unique_id": "1003",
        "title": "Baharat",
        "address": "91 Anderson St, Portland, ME 04101",
        "icon": "restaurant-15"
      }
      },
      { "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [-73.211040, 44.480980]
      },
      "properties": {
        "unique_id": "1004",
        "title": "Shalimar of India",
        "address": "16 N Winooski Ave, Burlington, VT 05401",
        "icon": "restaurant-15"
      }
      },
      { "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [-105.277040, 40.018760]
      },
      "properties": {
        "unique_id": "1005",
        "title": "Avanti Food and Beverage",
        "address": "1401 Pearl St, Boulder, CO 80302",
        "icon": "bar-15"
      }
      },
      { "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [-105.284409, 40.016201]
      },
      "properties": {
        "unique_id": "1006",
        "title": "Sherpa Restaurant",
        "address": "825 Walnut St, Boulder, CO 80302",
        "icon": "restaurant-15"
      }
      },
      { "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [-105.281630, 40.017860]
      },
      "properties": {
        "unique_id": "1007",
        "title": "Ash'Kara",
        "address": "1043 Pearl St, Boulder, CO 80302",
        "icon": "restaurant-15"
      }
      },
      { "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [-105.259430, 40.030048]
      },
      "properties": {
        "unique_id": "1008",
        "title": "Rayback Collective",
        "address": "2775 Valmont Rd, Boulder, CO 80304",
        "icon": "bar-15"
      }
      },
      { "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [-105.249860, 39.984390]
      },
      "properties": {
        "unique_id": "1009",
        "title": "Tandoori Grill",
        "address": "619 S Broadway, Boulder, CO 80305",
        "icon": "restaurant-15"
      }
      },
      { "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [-105.280683, 40.025155]
      },
      "properties": {
        "unique_id": "1010",
        "title": "Audrey Jane's Pizza Garage",
        "address": "2675 13th St, Boulder, CO 80304",
        "icon": "restaurant-15"
      }
      },
      { "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [-70.270611, 43.653212]
      },
      "properties": {
        "unique_id": "1011",
        "title": "Tandem Coffee and Bakery",
        "address": "742 Congress St, Portland, ME 04102",
        "icon": "bakery-15"
      }
      },
      { "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [-73.212434, 44.476096]
      },
      "properties": {
        "unique_id": "1012",
        "title": "Honey Road",
        "address": "156 Church St, Burlington, VT 05401",
        "icon": "restaurant-15"
      }
      },
      { "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [-73.211217, 44.480791]
      },
      "properties": {
        "unique_id": "1013",
        "title": "Â¡Duino! (Duende)",
        "address": "10 N Winooski Ave, Burlington, VT 05401",
        "icon": "restaurant-15"
      }
      },
      { "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [-108.543203, 39.107863]
      },
      "properties": {
        "unique_id": "1014",
        "title": "Denny's",
        "address": "710 Horizon Dr, Grand Junction, CO 81506",
        "icon": "restaurant-15"
      }
      },
      { "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [-73.078129, 44.132988]
      },
      "properties": {
        "unique_id": "1015",
        "title": "The Bobcat Cafe and Brewery",
        "address": "5 Main St, Bristol, VT 05443",
        "icon": "restaurant-15"
      }
      },
      { "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [-118.431447, 34.043674]
      },
      "properties": {
        "unique_id": "1016",
        "title": "The Bigg Chill",
        "address": "10850 W Olympic Blvd, Los Angeles, CA 90064",
        "icon": "ice-cream-15"
      }
      },
      { "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [-73.169624, 44.015006]
      },
      "properties": {
        "unique_id": "1017",
        "title": "American Flatbread",
        "address": "137 Maple St, Middlebury, VT 05753",
        "icon": "restaurant-15"
      }
      },
      { "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [-73.212590, 44.478089]
      },
      "properties": {
        "unique_id": "1018",
        "title": "Dobra Tea",
        "address": "80 Church St, Burlington, VT 05401",
        "icon": "restaurant-15"
      }
      },
      { "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [-105.090014, 39.991044]
      },
      "properties": {
        "unique_id": "1019",
        "title": "Ras Kassa's Ethiopian Restaurant",
        "address": "802 S Public Rd, Lafayette, CO 80026",
        "icon": "restaurant-15"
      }
      },
      { "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [-118.248501, 34.050513]
      },
      "properties": {
        "unique_id": "1020",
        "title": "Grand Central Market Fish Tacos",
        "address": "317 S Broadway, Los Angeles, CA 90013",
        "icon": "restaurant-15"
      }
      },
      { "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [-105.568604, 40.078327]
      },
      "properties": {
        "unique_id": "1021",
        "title": "Pawnee Campground",
        "address": "Brainard Lake Rd, Ward, CO 80481",
        "icon": "campsite-15"
      }
      },
      { "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [-105.746354, 40.110611]
      },
      "properties": {
        "unique_id": "1022",
        "title": "Monarch Lake Trailhead",
        "address": "Continental Divide Trail, Granby, CO 80446",
        "icon": "mountain-15"
      }
      },
      { "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [-73.169986, 44.011976]
      },
      "properties": {
        "unique_id": "1023",
        "title": "Otter Creek Bakery",
        "address": "14 College St, Middlebury, VT 05753",
        "icon": "bakery-15"
      }
      }
      ]
      };

const filterGroup = document.getElementById('filter-group');

function $(x) {return document.getElementById(x);}

const bounds = [
  [-155, 12], // Southwest coordinates
  [-40, 55]  // Northeast coordinates
];


const map = new mapboxgl.Map({
  container: 'map',
  style: 'mapbox://styles/twentworth/cinnf629w002yadncdunzrfqi',
  center: [-96.5, 39],
  zoom: 4,
  minZoom: 3,
  maxBounds: bounds,
  maxZoom: 17
});

// map.on('load', function() {
//   map.addSource('route', {
//     'type': 'geojson',
//     'data': {
//       'type': 'Feature',
//       'properties': {},
//       'geometry': {
//         'type': 'LineString',
//         'coordinates': [
//           [-73.212189, 44.482099],
//           [-72.876555, 44.374578],
//           [-73.165360, 44.013865],
//           [-71.422223, 43.672046],
//           [-70.292414, 43.650239],
//           [-70.787875, 43.088400],
//           [-70.986282, 42.972778],
//           [-71.123187, 42.370870]
//         ]
//       }
//     }
//   });
//   map.addLayer({
//     'id': 'route',
//     'type': 'line',
//     'source': 'route',
//     'layout': {
//       'line-join': 'round',
//       'line-cap': 'round'
//     },
//     'paint': {
//       'line-color': '#888',
//       'line-width': 8
//     }
//   });
// });

map.on('load', function() {
  // Add a new source from our GeoJSON data and set the
  // 'cluster' option to true. GL-JS will add the point_count property to your source data.
  map.addSource("points", {
    type: "geojson",
    // Point to GeoJSON data.
    // from 12/22/15 to 1/21/16 as logged by USGS' Earthquake hazards program.
    data: points,
    cluster: true,
    clusterMaxZoom: 12, // Max zoom to cluster points on
    clusterRadius: 40 // Radius of each cluster when clustering points (defaults to 50)
  });

  map.addLayer({
    id: "clusters",
    type: "circle",
    source: "points",
    filter: ["has", "point_count"],
    paint: {
      // Use step expressions (https://docs.mapbox.com/mapbox-gl-js/style-spec/#expressions-step)
      // with three steps to implement three types of circles:
      //   * Blue, 20px circles when point count is less than 100
      //   * Yellow, 30px circles when point count is between 100 and 750
      //   * Pink, 40px circles when point count is greater than or equal to 750
      // base color: #294151
      "circle-color": [
        "step",
        ["get", "point_count"],
        "#8C541C",
        2,
        "#8C541C",
        10,
        "#8C541C"
      ],
      "circle-radius": [
        "step",
        ["get", "point_count"],
        20,
        5,
        30,
        10,
        40
      ]
    }
  });

  map.addLayer({
    id: "cluster-count",
    type: "symbol",
    source: "points",
    filter: ["has", "point_count"],
    layout: {
      "text-field": "{point_count_abbreviated}",
      "text-font": ["DIN Offc Pro Medium", "Arial Unicode MS Bold"],
      "text-size": 12
    }
  });

  map.addLayer({
    id: "unclustered-point",
    type: "circle",
    source: "points",
    filter: ["!", ["has", "point_count"]],
    paint: {
      "circle-color": "#e7e9e9",
      "circle-radius": 12,
      "circle-stroke-width": .75, // .5
      "circle-stroke-color": "#8C541C"
    }
  });

  map.addLayer({
    'id': 'places',
    'type': 'symbol',
    'source': 'points',
    'layout': {
      'icon-image': '{icon}',
      'icon-allow-overlap': true
      //'icon-color':'#7CFC00'
    }
  });

  // When a click event occurs on a feature in the places layer, open a popup at the
  // location of the feature, with description HTML from its properties.
  map.on('click', 'places', (e) => {
    // Copy coordinates array.
    const coordinates = e.features[0].geometry.coordinates.slice();
    const title = e.features[0].properties.title;
    const address = e.features[0].properties.address;

    // Ensure that if the map is zoomed out such that multiple
    // copies of the feature are visible, the popup appears
    // over the copy being pointed to.
    while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
      coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
    }

    new mapboxgl.Popup()
    .setLngLat(coordinates)
    .setHTML(
      '<div class="container nopadding">' + '<h4>' + title + '</h4> \
      <p>' + address + '</p></div>' +
      // '<div class="row nopadding"><img src=' + img_url
      // + ' alt="could not display image" style="padding:0px 0px 5px 0px;width:225px;"></div>' +
      '</div>'
    )
    .addTo(map);


    // Ensure that if the map is zoomed out such that multiple
    // copies of the feature are visible, the popup appears
    // over the copy being pointed to.
    while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
      coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
    }
  });

  // Change the cursor to a pointer when the mouse is over the places layer.
  map.on('mouseenter', 'places', () => {
    map.getCanvas().style.cursor = 'pointer';
  });

  // Change it back to a pointer when it leaves.
  map.on('mouseleave', 'places', () => {
    map.getCanvas().style.cursor = '';
  });


  // for (const feature of points.features) {
  //   const symbol = feature.properties.icon;
  //   const layerID = `poi-${symbol}`;

  //     // Add a layer for this symbol type if it hasn't been added already.
  //     if (!map.getLayer(layerID)) {
  //       map.addLayer({
  //         'id': layerID,
  //         'type': 'symbol',
  //         'source': 'points',
  //         'layout': {
  //           // These icons are a part of the Mapbox Light style.
  //           // To view all images available in a Mapbox style, open
  //           // the style in Mapbox Studio and click the "Images" tab.
  //           // To add a new image to the style at runtime see
  //           // https://docs.mapbox.com/mapbox-gl-js/example/add-image/
  //           'icon-image': `${symbol}-15`,
  //           'icon-allow-overlap': true
  //         },
  //         'filter': ['==', 'icon', symbol]
  //       });
  //
  //       // Add checkbox and label elements for the layer.
  //       const input = document.createElement('input');
  //       input.type = 'checkbox';
  //       input.id = layerID;
  //       input.checked = true;
  //       filterGroup.appendChild(input);
  //
  //       const label = document.createElement('label');
  //       label.setAttribute('for', layerID);
  //       label.textContent = symbol;
  //       filterGroup.appendChild(label);
  //
  //       // When the checkbox changes, update the visibility of the layer.
  //       input.addEventListener('change', (e) => {
  //         map.setLayoutProperty(
  //           layerID,
  //           'visibility',
  //           e.target.checked ? 'visible' : 'none'
  //         );
  //       });
  //     }
  //   }
  //
  // inspect a cluster on click
  map.on('click', 'clusters', function (e) {
    var features = map.queryRenderedFeatures(e.point, { layers: ['clusters'] });
    var clusterId = features[0].properties.cluster_id;
    map.getSource('points').getClusterExpansionZoom(clusterId, function (err, zoom) {
      if (err)
      return;

      map.easeTo({
        center: features[0].geometry.coordinates,
        zoom: zoom
      });
    });
  });

  map.on('mouseenter', 'clusters', function () {
    map.getCanvas().style.cursor = 'pointer';
  });
  map.on('mouseleave', 'clusters', function () {
    map.getCanvas().style.cursor = '';
  });
  //
  //
  //   map.on('click', 'unclustered-point', function (e) {
  //     var coordinates = e.features[0].geometry.coordinates.slice();
  //     var unique_id = e.features[0].properties.unique_id;
  //     var title = e.features[0].properties.title;
  //     var address = e.features[0].properties.address;
  //     var description = e.features[0].properties.description;
  //     var teaser_url = e.features[0].properties.teaser_url;
  //     var img_url = e.features[0].properties.img_url;
  //
  //     // map.flyTo({
  //     //   center: coordinates,
  //     //   zoom: 6,
  //     //   speed: 0.75
  //     //   });
  //
  //     new mapboxgl.Popup()
  //     .setLngLat(coordinates)
  //     .setHTML(
  //       '<div class="container nopadding">' + '<h4>' + title + '</h4> \
  //       <p>' + address + '</p></div>' +
  //       // '<div class="row nopadding"><img src=' + img_url
  //       // + ' alt="could not display image" style="padding:0px 0px 5px 0px;width:225px;"></div>' +
  //       '</div>'
  //     )
  //     .addTo(map);
  //
  //
  //     // Ensure that if the map is zoomed out such that multiple
  //     // copies of the feature are visible, the popup appears
  //     // over the copy being pointed to.
  //     while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
  //       coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
  //     }
  //   });
  //
  //   // Change the cursor to a pointer when the mouse is over the places layer.
  //   map.on('mouseenter', 'unclustered-point', function () {
  //     map.getCanvas().style.cursor = 'pointer';
  //   });
  //
  //   // Change it back to a pointer when it leaves.
  //   map.on('mouseleave', 'unclustered-point', function () {
  //     map.getCanvas().style.cursor = '';
  //   });
});



// Add zoom and rotation controls to the map.
var nav = new mapboxgl.NavigationControl();
map.addControl(nav, 'bottom-left');

</script>

</body>
</html>
