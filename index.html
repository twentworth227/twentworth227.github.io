<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8' />
  <title>atyourbest</title>
  <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
  <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.1.1/mapbox-gl.js'></script>
  <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.1.1/mapbox-gl.css' rel='stylesheet' />
  <link href="stylesheet.css" rel="stylesheet" type="text/css" />
  <style>
  body { margin:0; padding:0; }
  #map { position:absolute; top:0; bottom:0; width:100%; }

</style>
</head>
<body>

  <div id='map'></div>

  <script>
  mapboxgl.accessToken = 'pk.eyJ1IjoidHdlbnR3b3J0aCIsImEiOiJjank3bmthZXEwMWN5M2hvMmVpZDV4aWhyIn0.aEBI-qd5b-yv7wbstwhLnA';

  var geojson = {
    "type": "FeatureCollection",
    "features": [
      { "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [-73.210398, 44.481452]
      },
      "properties": {
        "unique_id": "1001",
        "title": "Thomas - Burlington, VT",
        "description": "Listen to this silly song.",
        "url": "audio_files/upbeat_minor.mp3",
        "img_url": "pictures/first.jpg"
      }
    },
    { "type": "Feature",
    "geometry": {
      "type": "Point",
      "coordinates": [-73.1673, 44.0153]
    },
    "properties": {
      "unique_id": "1002",
      "title": "Anderson - Middlebury, VT",
      "description": "Milktoast.",
      "url": "audio_files/ner2.mp3",
      "img_url": "pictures/second.jpg"
    }
  },
]
};


  var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/twentworth/cjy7nu17v04vz1cp69y5xka6g',
    // center: [-77.04, 38.907],
    // zoom: 11.15
  });

  function play(unique_id) {
      var audio = document.getElementById(String(unique_id));
      // console.log(String(unique_id))
      if (audio.paused) {
          audio.play();
      } else{
          audio.pause();
          // audio.currentTime = 0
      }
  }

  function stop(unique_id) {
      var audio = document.getElementById(String(unique_id));
      if (audio.playing) {
          audio.stop();
          audio.pause();
          audio.currentTime = 0;
        } else{
          audio.pause();
          audio.currentTime = 0;
        }
      }

    function show_image(src, width, height, alt) {
        var img = document.createElement("img");
        img.src = src;
        img.width = 60;
        img.height = 60;
        img.alt = 'could not display image';

        // This next line will just add it to the <body> tag
        document.body.appendChild(img);
    }

  // add markers to map
  geojson.features.forEach(function(marker) {

    // create a HTML element for each feature
    var el = document.createElement('div');
    el.className = 'marker';

    var unique_id = marker.properties.unique_id;

    // make a marker for each feature and add to the map
    new mapboxgl.Marker(el)
    .setLngLat(marker.geometry.coordinates)
    new mapboxgl.Marker(el)
    .setLngLat(marker.geometry.coordinates)
    .setPopup(new mapboxgl.Popup({ offset: 25 }) // add popups
    // .setHTML('<h3>' + marker.properties.title + '</h3><p>' + marker.properties.description + '</p>' +
    // "<button class='player__play button button--large' onclick='soundManager.play('audio')'>Play</button>"))
    .setHTML('<h3>' + marker.properties.title + '</h3><p>' + marker.properties.description + '</p>' +
    '<img src=' + marker.properties.img_url + ' alt="could not display image" style="width:150px;height:150px;">' +
    '<br>' + '<audio id=' + unique_id + ' src=' + marker.properties.url + '></audio>' +
    '<button onClick="play(' + unique_id + ')">Play/Pause</button>' +
    '<button onClick="stop(' + unique_id + ')">Stop</button>'))

    .addTo(map);
  });


  // <button onclick=
  //     "show_image('http://google.com/images/logo.gif',
  //                  276,
  //                  110,
  //                  'Google Logo');">Add Google Logo</button>

  // // Ensure that if the map is zoomed out such that multiple
  // // copies of the feature are visible, the popup appears
  // // over the copy being pointed to.
  // while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
  // coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
  // }


</script>

</body>
</html>
